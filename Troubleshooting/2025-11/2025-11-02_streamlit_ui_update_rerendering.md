# Streamlit ã® UI æ›´æ–°ã«ã‚ˆã‚‹å‡¦ç†ä¸­æ–­å•é¡Œ

**æ—¥ä»˜**: 2025-11-02
**Keywords**: Streamlit, rerendering, å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°, UIæ›´æ–°, å‡¦ç†ä¸­æ–­, st.spinner, debug_log, show_in_ui, ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
**Error**: å‡¦ç†ãŒé€”ä¸­ã§ä¸­æ–­ã•ã‚Œã€å®Œäº†ã—ãªã„
**å½±éŸ¿ç¯„å›²**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜å‡¦ç†ã€é•·æ™‚é–“å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†å…¨èˆ¬
**é‡è¦åº¦**: ğŸŸ¡ Important

---

## ç—‡çŠ¶

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ä¿å­˜å‡¦ç†ä¸­ã«ã€å‡¦ç†ãŒé€”ä¸­ã§ä¸­æ–­ã•ã‚Œã€å®Œäº†ã—ãªã„ã€‚

**æœŸå¾…å‹•ä½œ**: 
- ãƒãƒ£ãƒ³ãƒãƒ«ä¿å­˜ â†’ å‹•ç”»ä¿å­˜ â†’ æ¤œç´¢å±¥æ­´ä¿å­˜ãŒé †ç•ªã«å®Œäº†
- å…¨ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¦ã‹ã‚‰ç”»é¢ãŒæ›´æ–°ã•ã‚Œã‚‹

**å®Ÿéš›ã®å‹•ä½œ**: 
- ãƒãƒ£ãƒ³ãƒãƒ«ä¿å­˜ã¯å®Œäº†
- ã€Œå‹•ç”»ä¿å­˜ã‚’é–‹å§‹ã€ã®ãƒ­ã‚°ã¯è¡¨ç¤ºã•ã‚Œã‚‹ãŒã€ãã®å¾Œå‡¦ç†ãŒä¸­æ–­
- ç”»é¢ãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã€å‡¦ç†ãŒæœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã•ã‚Œã‚‹

**ãƒ­ã‚°ã®ä¾‹**:
```
Debug: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å–å¾—å®Œäº†
Debug: ãƒãƒ£ãƒ³ãƒãƒ«ä¿å­˜ã‚’é–‹å§‹: 38ä»¶
Debug: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ä¸­...  â† ã“ã“ã§å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
Debug: Streamlitã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚­ãƒ¼: [...]
```

---

## åŸå› 

### æ ¹æœ¬åŸå› 

Streamlit ã¯ **UI ã«å¤‰æ›´ãŒã‚ã‚‹ãŸã³ã«ãƒšãƒ¼ã‚¸å…¨ä½“ã‚’å†å®Ÿè¡Œ**ã™ã‚‹ä»•çµ„ã¿ã€‚ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’ UI ã«å‡ºåŠ›ã™ã‚‹ã¨ã€ãã®åº¦ã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿã—ã€å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã‚‹ã€‚

**å•é¡Œã®ã‚³ãƒ¼ãƒ‰**:
```python
def debug_log(message, show_in_ui=True):  # âŒ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ UI ã«è¡¨ç¤º
    """ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨UIã«å‡ºåŠ›"""
    print(f"Debug: {message}")
    if show_in_ui:
        st.markdown(f'<div class="debug-info">ğŸ” Debug: {message}</div>', unsafe_allow_html=True)

# å‡¦ç†ä¸­ã«é »ç¹ã«å‘¼ã³å‡ºã•ã‚Œã‚‹
debug_log("ãƒãƒ£ãƒ³ãƒãƒ«ä¿å­˜ã‚’é–‹å§‹: 38ä»¶")  # UIæ›´æ–° â†’ å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
for channel in channels:
    db.save_channel(channel)
    debug_log(f"ãƒãƒ£ãƒ³ãƒãƒ«ä¿å­˜: {channel_id}")  # UIæ›´æ–° â†’ å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
```

**ãªãœå‡¦ç†ãŒä¸­æ–­ã™ã‚‹ã‹**:
1. `st.markdown()` ãŒå‘¼ã°ã‚Œã‚‹ã¨ UI ãŒæ›´æ–°ã•ã‚Œã‚‹
2. UI æ›´æ–°ã«ã‚ˆã‚Š Streamlit ãŒãƒšãƒ¼ã‚¸ã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
3. å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«ç¾åœ¨ã®å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã‚‹
4. ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæœ€åˆã‹ã‚‰å†å®Ÿè¡Œã•ã‚Œã‚‹
5. â†’ å‡¦ç†ãŒå®Œäº†ã—ãªã„ç„¡é™ãƒ«ãƒ¼ãƒ—

### Streamlit ã®å‹•ä½œåŸç†

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œï¼ˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼‰
â†“
ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œé–‹å§‹
â†“
UIæ›´æ–°ï¼ˆst.markdown ãªã©ï¼‰
â†“
å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç™ºç”Ÿ
â†“
ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæœ€åˆã‹ã‚‰å†å®Ÿè¡Œ  â† å‡¦ç†ãŒä¸­æ–­ï¼
```

---

## å¯¾å‡¦

### è§£æ±ºç­–1: ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’å¤‰æ›´

**ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰**:
```python
def debug_log(message, show_in_ui=False):  # âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ UI ã«è¡¨ç¤ºã—ãªã„
    """ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨UIã«å‡ºåŠ›"""
    print(f"Debug: {message}")
    if show_in_ui:
        st.markdown(f'<div class="debug-info">ğŸ” Debug: {message}</div>', unsafe_allow_html=True)
```

**åŠ¹æœ**:
- ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ã¯ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹ï¼ˆãƒ‡ãƒãƒƒã‚°å¯èƒ½ï¼‰
- UI ã¯æ›´æ–°ã•ã‚Œãªã„ï¼ˆå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿã—ãªã„ï¼‰
- å‡¦ç†ãŒä¸­æ–­ã•ã‚Œãšã€æœ€å¾Œã¾ã§å®Œäº†ã™ã‚‹

### è§£æ±ºç­–2: st.spinner ã§å‡¦ç†å…¨ä½“ã‚’å›²ã‚€

```python
with st.spinner("YouTube APIã§æ¤œç´¢ãƒ»ä¿å­˜ä¸­..."):
    # ã“ã®ä¸­ã®å‡¦ç†ã¯ä¸­æ–­ã•ã‚Œã«ãã„
    youtube_api = get_youtube_api()
    videos_data, channels_data = youtube_api.search_and_get_details(...)
    
    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜
    db = get_database()
    for channel in channels_data.values():
        db.upsert_channel(channel)
    for video in videos_data:
        db.insert_video(video)
```

**åŠ¹æœ**:
- `st.spinner` å†…ã®å‡¦ç†ã¯å„ªå…ˆçš„ã«å®Ÿè¡Œã•ã‚Œã‚‹
- UI æ›´æ–°ãŒæŠ‘åˆ¶ã•ã‚Œã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€²è¡ŒçŠ¶æ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### è§£æ±ºç­–3: é‡è¦ãªãƒ­ã‚°ã®ã¿ UI ã«è¡¨ç¤º

```python
# âŒ ã™ã¹ã¦ã®ãƒ­ã‚°ã‚’ UI ã«è¡¨ç¤º
debug_log("ãƒãƒ£ãƒ³ãƒãƒ«ä¿å­˜ã‚’é–‹å§‹", show_in_ui=True)
debug_log("ãƒãƒ£ãƒ³ãƒãƒ«1ã‚’ä¿å­˜", show_in_ui=True)
debug_log("ãƒãƒ£ãƒ³ãƒãƒ«2ã‚’ä¿å­˜", show_in_ui=True)
# ... 38å›ç¹°ã‚Šè¿”ã— â†’ 38å›å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

# âœ… é‡è¦ãªãƒ­ã‚°ã®ã¿ UI ã«è¡¨ç¤º
debug_log("ãƒãƒ£ãƒ³ãƒãƒ«ä¿å­˜ã‚’é–‹å§‹")  # ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®ã¿
for channel in channels:
    db.save_channel(channel)
debug_log(f"ãƒãƒ£ãƒ³ãƒãƒ«ä¿å­˜å®Œäº†: {len(channels)}ä»¶", show_in_ui=True)  # å®Œäº†æ™‚ã®ã¿UI
```

---

## ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«

- `app.py` (69è¡Œç›®)
  - `debug_log` é–¢æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã‚’ `show_in_ui=False` ã«å¤‰æ›´

---

## äºˆé˜²ç­–

### 1. UI æ›´æ–°ã¯æœ€å°é™ã«

```python
# âŒ æ‚ªã„ä¾‹: ãƒ«ãƒ¼ãƒ—å†…ã§ UI æ›´æ–°
for i in range(100):
    st.write(f"å‡¦ç†ä¸­: {i}")  # 100å›å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

# âœ… è‰¯ã„ä¾‹: å®Œäº†æ™‚ã®ã¿ UI æ›´æ–°
for i in range(100):
    process(i)
st.write("å‡¦ç†å®Œäº†: 100ä»¶")  # 1å›ã ã‘
```

### 2. st.spinner ã‚’æ´»ç”¨

```python
with st.spinner("å‡¦ç†ä¸­..."):
    # é•·æ™‚é–“å‡¦ç†
    result = heavy_computation()
# spinner çµ‚äº†å¾Œã«çµæœè¡¨ç¤º
st.success(f"å®Œäº†: {result}")
```

### 3. ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ´»ç”¨

```python
# å‡¦ç†æ¸ˆã¿ãƒ•ãƒ©ã‚°ã‚’ä¿å­˜
if 'processed' not in st.session_state:
    with st.spinner("å‡¦ç†ä¸­..."):
        result = heavy_computation()
        st.session_state.processed = True
        st.session_state.result = result

# å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
if st.session_state.processed:
    st.write(f"çµæœ: {st.session_state.result}")
```

### 4. ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®ä½¿ã„åˆ†ã‘

```python
# é–‹ç™ºæ™‚: UI ã«è¡¨ç¤ºã—ã¦ãƒ‡ãƒãƒƒã‚°
debug_log("è©³ç´°æƒ…å ±", show_in_ui=True)

# æœ¬ç•ª: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®ã¿
debug_log("è©³ç´°æƒ…å ±", show_in_ui=False)

# é‡è¦ãªæƒ…å ±ã®ã¿ UI ã«è¡¨ç¤º
st.success("âœ… å‡¦ç†å®Œäº†")
st.error("âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ")
```

---

## é–¢é€£å•é¡Œ

- `2025-11-02_async_event_loop_runtime_error.md` - éåŒæœŸå‡¦ç†ã®å•é¡Œ
- `2025-11-02_turso_http_api_parameter_format.md` - API ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å•é¡Œ

---

## å­¦ã‚“ã ã“ã¨

### 1. Streamlit ã®å‹•ä½œç‰¹æ€§

| å‹•ä½œ | å½±éŸ¿ |
|------|------|
| `st.write()` | å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç™ºç”Ÿ |
| `st.markdown()` | å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç™ºç”Ÿ |
| `st.success()` | å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç™ºç”Ÿ |
| `print()` | å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãªã— |
| `st.spinner` å†… | å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æŠ‘åˆ¶ |

### 2. ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®è¨­è¨ˆ

```python
# é–‹ç™ºæ™‚ã¨æœ¬ç•ªã§åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã«
DEBUG_MODE = os.getenv("DEBUG", "false").lower() == "true"

def debug_log(message, show_in_ui=None):
    print(f"Debug: {message}")
    if show_in_ui is None:
        show_in_ui = DEBUG_MODE
    if show_in_ui:
        st.markdown(f"ğŸ” {message}")
```

### 3. é•·æ™‚é–“å‡¦ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

```python
def long_running_task():
    with st.spinner("å‡¦ç†ä¸­..."):
        # ã‚¹ãƒ†ãƒƒãƒ—1
        result1 = step1()
        
        # ã‚¹ãƒ†ãƒƒãƒ—2
        result2 = step2(result1)
        
        # ã‚¹ãƒ†ãƒƒãƒ—3
        result3 = step3(result2)
    
    # å®Œäº†å¾Œã«çµæœè¡¨ç¤º
    st.success("âœ… å‡¦ç†å®Œäº†")
    st.write(result3)
```

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

| å•é¡Œ | å¯¾å‡¦ |
|------|------|
| é »ç¹ãª UI æ›´æ–° | ãƒãƒƒãƒå‡¦ç† + å®Œäº†æ™‚ã®ã¿è¡¨ç¤º |
| å¤§é‡ã®ãƒ­ã‚°å‡ºåŠ› | ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®ã¿ or ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ› |
| é‡ã„è¨ˆç®— | `@st.cache_data` ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ |
| å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° | `st.session_state` ã§çŠ¶æ…‹ç®¡ç† |

---

## è¿½åŠ æƒ…å ±

### Streamlit ã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’é˜²ããƒ†ã‚¯ãƒ‹ãƒƒã‚¯

#### 1. st.session_state ã§ãƒ•ãƒ©ã‚°ç®¡ç†

```python
if 'data_loaded' not in st.session_state:
    st.session_state.data_loaded = False

if not st.session_state.data_loaded:
    with st.spinner("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­..."):
        data = load_data()
        st.session_state.data = data
        st.session_state.data_loaded = True

# å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
st.write(st.session_state.data)
```

#### 2. st.cache_data ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥

```python
@st.cache_data
def load_data():
    # é‡ã„å‡¦ç†
    return expensive_computation()

# åˆå›ã®ã¿å®Ÿè¡Œã€ä»¥é™ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
data = load_data()
```

#### 3. st.form ã§ä¸€æ‹¬å‡¦ç†

```python
with st.form("my_form"):
    name = st.text_input("åå‰")
    age = st.number_input("å¹´é½¢")
    submitted = st.form_submit_button("é€ä¿¡")
    
    if submitted:
        # ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®ã¿å®Ÿè¡Œ
        process(name, age)
```

### ãƒ‡ãƒãƒƒã‚°ã®ã‚³ãƒ„

```python
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ãƒ­ã‚°ã‚’ç¢ºèª
print(f"Debug: {message}")

# ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ­ã‚°ã‚’å‡ºåŠ›
with open("debug.log", "a") as f:
    f.write(f"{datetime.now()}: {message}\n")

# st.expander ã§æŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ã«
with st.expander("ãƒ‡ãƒãƒƒã‚°æƒ…å ±"):
    st.write(debug_info)
```

---

**ğŸ”¥ é‡è¦**: Streamlit ã§ã¯ UI æ›´æ–°ãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’å¼•ãèµ·ã“ã™ï¼é•·æ™‚é–“å‡¦ç†ã¯ `st.spinner` å†…ã§å®Œçµã•ã›ã€ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã¯æœ€å°é™ã«ï¼
